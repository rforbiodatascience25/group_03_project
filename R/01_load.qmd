---
title: "01_load"
format: html
editor: visual
---

## Library loading

```{r}
library(GEOquery)
library(dplyr)
library(tibble)
library(tidyverse)
library(stringr)
```

## Running Code

Downloading of all the data we need.

```{r}

gse <- getGEO("GSE54514", GSEMatrix = TRUE)

# If multiple platforms, take the first one
gse <- gse[[1]]

# Inspect
exprs_data <- exprs(gse)
pheno_data <- pData(gse)
feature_data <- fData(gse)

```

load raw_data

```{r}

# Download full SOFT file (untidy)
gse_raw <- getGEO("GSE54514", GSEMatrix = FALSE)

# Extract all samples
gsms <- GSMList(gse_raw)

# Extract raw metadata (untidy)
meta_untidy <- lapply(gsms, function(gsm) {
  tibble(
    sample = Meta(gsm)$geo_accession,           # Correct way to get sample ID
    characteristics = Meta(gsm)$characteristics_ch1  # untidy fields
  )
}) |> bind_rows()

# Load Platform

```{r}
platform_raw <- getGEO("GPL6947")
platform_table = platform_raw@dataTable@table

directory = getwd()
if (str_sub(directory,-1) == 'R'){
  directory = str_sub(directory,1,-3)
}

write_tsv(x = platform_table, 
          file = file.path(directory,'data/platform_table.tsv'))

```

